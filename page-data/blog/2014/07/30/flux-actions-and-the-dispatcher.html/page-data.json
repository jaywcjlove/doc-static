{"componentChunkName":"component---src-templates-blog-js","path":"/blog/2014/07/30/flux-actions-and-the-dispatcher.html","result":{"data":{"markdownRemark":{"html":"<p>Flux is the application architecture Facebook uses to build JavaScript applications. It’s based on a unidirectional data flow.  We’ve built everything from small widgets to huge applications with Flux, and it’s handled everything we’ve thrown at it. Because we’ve found it to be a great way to structure our code, we’re excited to share it with the open source community. <a href=\"http://youtu.be/nYkdrAPrdcw?t=10m20s\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jing Chen presented Flux</a> at the F8 conference, and since that time we’ve seen a lot of interest in it. We’ve also published an <a href=\"https://facebook.github.io/flux/docs/overview.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">overview of Flux</a> and a <a href=\"https://github.com/facebook/flux/tree/main/examples/flux-todomvc/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TodoMVC example</a>, with an accompanying <a href=\"https://facebook.github.io/flux/docs/todo-list.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tutorial</a>.</p>\n<p>Flux is more of a pattern than a full-blown framework, and you can start using it without a lot of new code beyond React. Up until recently, however, we haven’t released one crucial piece of our Flux software: the dispatcher. But along with the creation of the new <a href=\"https://github.com/facebook/flux\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flux code repository</a> and <a href=\"https://facebook.github.io/flux/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flux website</a>, we’ve now open sourced the same <a href=\"https://facebook.github.io/flux/docs/dispatcher.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dispatcher</a> we use in our production applications.</p>\n<h2 id=\"where-the-dispatcher-fits-in-the-flux-data-flow\"><a href=\"#where-the-dispatcher-fits-in-the-flux-data-flow\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where the Dispatcher Fits in the Flux Data Flow</h2>\n<p>The dispatcher is a singleton, and operates as the central hub of data flow in a Flux application. It is essentially a registry of callbacks, and can invoke these callbacks in order. Each <em>store</em> registers a callback with the dispatcher. When new data comes into the dispatcher, it then uses these callbacks to propagate that data to all of the stores. The process of invoking the callbacks is initiated through the dispatch() method, which takes a data payload object as its sole argument.</p>\n<h2 id=\"actions-and-actioncreators\"><a href=\"#actions-and-actioncreators\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actions and ActionCreators</h2>\n<p>When new data enters the system, whether through a person interacting with the application or through a web api call, that data is packaged into an <em>action</em> — an object literal containing the new fields of data and a specific action type. We often create a library of helper methods called ActionCreators that not only create the action object, but also pass the action to the dispatcher.</p>\n<p>Different actions are identified by a type attribute. When all of the stores receive the action, they typically use this attribute to determine if and how they should respond to it. In a Flux application, both stores and views control themselves; they are not acted upon by external objects. Actions flow into the stores through the callbacks they define and register, not through setter methods.</p>\n<p>Letting the stores update themselves eliminates many entanglements typically found in MVC applications, where cascading updates between models can lead to unstable state and make accurate testing very difficult. The objects within a Flux application are highly decoupled, and adhere very strongly to the <a href=\"https://en.wikipedia.org/wiki/Law_of_Demeter\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Law of Demeter</a>, the principle that each object within a system should know as little as possible about the other objects in the system. This results in software that is more maintainable, adaptable, testable, and easier for new engineering team members to understand.</p>\n\n  <a class=\"gatsby-resp-image-link\" href=\"/static/b4643456a3de61c8352415a6fc171876/c658e/flux-diagram.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 840px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVQoz3VSzU8TQRzdP8A/wavxYvBk4s14bDzSpCRGmwAx5eTFG+EgidGooSLBIKFRDK2CLdtdFRJYQ8siphXb+rFuu1u3H+viwmJLLfs5s7NO24tGfXmT+c3lvXlvhrD/BwBsCDEdx2FZliRJKkkxDGOaJnQ9ADFdwrIsswvLtjuzYZq6YUPX+CY3pqcaC0/2tf2RUOiCz4c5EAgoqlpYn04vXC3nVwkIodcF7KI3u65rtttaodAUBQOAbCbDdPFma0vXDUXK8/k1bVciymUpvkw/T1BSvVYTd6nIa3J2XfgiA1X5QSdbFKkLpY4eQnjhHacQd6jsSlitfiTiy1T/QNAfCCZXVzaSO1fOXR86OxaPbRpZ9mB48GAw2KCTlueZ2NEwLMvWj1rkrfNzoWMZ+jbxmeNnI/MP5x5zpWJFUKKTL6JhushVdaUux2Lqs6fNUhF0kkAPQQAcXAuXimwvjcn89h+ZXQh6dwMA4NhO74DQzyNdrO+JdfWw1cYCFe17ripqreZvbfdgWoZhYp/3fG105tW1KfodV1nL8GeG7/cFJx69fOshp//mxRMjp+8m7hF/PzDWwXbpnHBpPOofnWcyHJn+cOryRF8wPLmUgtDyjfuPD528sXiH+OcHwcVAHAFBhHAo9FXem0mwD+KbXFn2kMvkNhZT8U8S9wtiXfBWu20/6QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"flux diagram\" title src=\"/static/b4643456a3de61c8352415a6fc171876/1e088/flux-diagram.png\" srcset=\"/static/b4643456a3de61c8352415a6fc171876/65ed1/flux-diagram.png 210w,\n/static/b4643456a3de61c8352415a6fc171876/d10fb/flux-diagram.png 420w,\n/static/b4643456a3de61c8352415a6fc171876/1e088/flux-diagram.png 840w,\n/static/b4643456a3de61c8352415a6fc171876/78612/flux-diagram.png 1260w,\n/static/b4643456a3de61c8352415a6fc171876/21cdd/flux-diagram.png 1680w,\n/static/b4643456a3de61c8352415a6fc171876/c658e/flux-diagram.png 2202w\" sizes=\"(max-width: 840px) 100vw, 840px\">\n    </span>\n  </span>\n  \n  </a>\n    \n<h2 id=\"why-we-need-a-dispatcher\"><a href=\"#why-we-need-a-dispatcher\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why We Need a Dispatcher</h2>\n<p>As an application grows, dependencies across different stores are a near certainty. Store A will inevitably need Store B to update itself first, so that Store A can know how to update itself. We need the dispatcher to be able to invoke the callback for Store B, and finish that callback, before moving forward with Store A. To declaratively assert this dependency, a store needs to be able to say to the dispatcher, “I need to wait for Store B to finish processing this action.” The dispatcher provides this functionality through its waitFor() method.</p>\n<p>The dispatch() method provides a simple, synchronous iteration through the callbacks, invoking each in turn. When waitFor() is encountered within one of the callbacks, execution of that callback stops and waitFor() provides us with a new iteration cycle over the dependencies. After the entire set of dependencies have been fulfilled, the original callback then continues to execute.</p>\n<p>Further, the waitFor() method may be used in different ways for different actions, within the same store’s callback.  In one case, Store A might need to wait for Store B.  But in another case, it might need to wait for Store C.  Using waitFor() within the code block that is specific to an action allows us to have fine-grained control of these dependencies.</p>\n<p>Problems arise, however, if we have circular dependencies. That is, if Store A needs to wait for Store B, and Store B needs to wait for Store A, we could wind up in an endless loop. The dispatcher now available in the Flux repo protects against this by throwing an informative error to alert the developer that this problem has occurred. The developer can then create a third store and resolve the circular dependency.</p>\n<h2 id=\"example-chat-app\"><a href=\"#example-chat-app\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Chat App</h2>\n<p>Along with the same dispatcher that Facebook uses in its production applications, we’ve also published a new example <a href=\"https://github.com/facebook/flux/tree/main/examples/flux-chat\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">chat app</a>, slightly more complicated than the simplistic TodoMVC, so that engineers can better understand how Flux solves problems like dependencies between stores and calls to a web API.</p>\n<p>We’re hopeful that the new Flux repository will grow with time to include additional tools, boilerplate code and further examples. And we hope that Flux will prove as useful to you as it has to us. Enjoy!</p>","excerpt":"Flux is the application architecture Facebook uses to build JavaScript applications. It’s based on a unidirectional data flow.  We’ve built everything from small widgets to huge applications with Flux, and it’s handled everything we’ve thrown at it. Because we’ve found it to be a great way to structure our code, we’re excited to share it with the open source community. Jing Chen presented Flux at the F8 conference, and since that time we’ve seen a lot of interest in it. We’ve also published an…","frontmatter":{"title":"Flux: Actions and the Dispatcher","next":null,"prev":null,"author":[{"frontmatter":{"name":"Bill Fisher","url":"https://twitter.com/fisherwebdev"}}]},"fields":{"date":"July 30, 2014","path":"content/blog/2014-07-30-flux-actions-and-the-dispatcher.md","slug":"/blog/2014/07/30/flux-actions-and-the-dispatcher.html"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"React 18 发布计划"},"fields":{"slug":"/blog/2021/06/08/the-plan-for-react-18.html"}}},{"node":{"frontmatter":{"title":"介绍 Zero-Bundle-Size 的 React 服务端组件"},"fields":{"slug":"/blog/2020/12/21/data-fetching-with-react-server-components.html"}}},{"node":{"frontmatter":{"title":"React v17.0"},"fields":{"slug":"/blog/2020/10/20/react-v17.html"}}},{"node":{"frontmatter":{"title":"介绍全新的 JSX 转换"},"fields":{"slug":"/blog/2020/09/22/introducing-the-new-jsx-transform.html"}}},{"node":{"frontmatter":{"title":"React v17.0 RC 版本发布：没有新特性"},"fields":{"slug":"/blog/2020/08/10/react-v17-rc.html"}}},{"node":{"frontmatter":{"title":"React v16.13.0"},"fields":{"slug":"/blog/2020/02/26/react-v16.13.0.html"}}},{"node":{"frontmatter":{"title":"Building Great User Experiences with Concurrent Mode and Suspense"},"fields":{"slug":"/blog/2019/11/06/building-great-user-experiences-with-concurrent-mode-and-suspense.html"}}},{"node":{"frontmatter":{"title":"使用 React 预发布版为新功能打基础"},"fields":{"slug":"/blog/2019/10/22/react-release-channels.html"}}},{"node":{"frontmatter":{"title":"全新的 React DevTools 简介"},"fields":{"slug":"/blog/2019/08/15/new-react-devtools.html"}}},{"node":{"frontmatter":{"title":"React v16.9.0 发布及 Roadmap 最新进展"},"fields":{"slug":"/blog/2019/08/08/react-v16.9.0.html"}}}]}},"pageContext":{"slug":"/blog/2014/07/30/flux-actions-and-the-dispatcher.html"}},"staticQueryHashes":[]}