{
  "id": "guide/migration-renderer",
  "title": "Renderer to Renderer2 migration",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular-cn/edit/aio/aio/content/guide/migration-renderer.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"renderer-to-renderer2-migration\" translation-result=\"on\"><code>Renderer</code> 到 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 的迁移<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#renderer-to-renderer2-migration\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\" id=\"renderer-to-renderer2-migration\"><code>Renderer</code> to <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> migration<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#renderer-to-renderer2-migration\"><i class=\"material-icons\">link</i></a></h1>\n\n<h2 id=\"migration-overview\" translation-result=\"on\">迁移概述<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#migration-overview\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"migration-overview\">Migration Overview<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#migration-overview\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">自 Angular 版本 4 开始，<code>Renderer</code> 类就被标记为已弃用。本节提供了一些指导，帮助你把这个已弃用的 API 迁移到更新的 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> API，并解释了它对你的应用而言意味着什么。</p><p translation-origin=\"off\">The <code>Renderer</code> class has been marked as deprecated since Angular version 4.\nThis section provides guidance on migrating from this deprecated API to the newer <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> API and what it means for your app.</p>\n\n<h2 id=\"why-should-i-migrate-to-renderer2\" translation-result=\"on\">为什么要迁移到 Renderer2？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#why-should-i-migrate-to-renderer2\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"why-should-i-migrate-to-renderer2\">Why should I migrate to Renderer2?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#why-should-i-migrate-to-renderer2\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">已弃用的 <code>Renderer</code> 类已经在 Angular 的 9 中删除了，所以有必要迁移到支持的 API。建议使用 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 策略，因为它支持与 <code>Renderer</code> 很相似的一组功能。这个 API 非常庞大（有 19 种方法），但原理图会帮你简化这个过程。</p><p translation-origin=\"off\">The deprecated <code>Renderer</code> class has been removed in version 9 of Angular, so it's necessary to migrate to a supported API.\nUsing <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> is the recommended strategy because it supports a similar set of functionality to <code>Renderer</code>.\nThe API surface is quite large (with 19 methods), but the schematic should simplify this process for your applications.</p>\n\n<h2 id=\"is-there-action-required-on-my-end\" translation-result=\"on\">完成后我还要采取什么行动吗？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#is-there-action-required-on-my-end\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"is-there-action-required-on-my-end\">Is there action required on my end?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#is-there-action-required-on-my-end\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">这个原理图应该可以处理大多数情况，仅仅不支持 <code>Renderer.animate()</code> 和 <code>Renderer.setDebugInfo()</code>。</p><p translation-origin=\"off\">No.\nThe schematic should handle most cases with the exception of <code>Renderer.animate()</code> and <code>Renderer.setDebugInfo()</code>, which already aren't supported.</p>\n\n<h2 id=\"what-are-the-__ngrendererx-methods-why-are-they-necessary\" translation-result=\"on\">什么是 <code>__ngRendererX</code> 方法族？为什么要用它们？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#what-are-the-__ngrendererx-methods-why-are-they-necessary\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\" id=\"what-are-the-__ngrendererx-methods-why-are-they-necessary\">What are the <code>__ngRendererX</code> methods? Why are they necessary?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#what-are-the-__ngrendererx-methods-why-are-they-necessary\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">有些方法在 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 没有完全等价的东西，或者对应于多个表达式。例如，这两种渲染器都有 <code>createElement()</code> 的方法，但它们是不相等的，比如在 <code>Renderer</code> 中调用 <code>renderer.createElement(parentNode, namespaceAndName)</code> 时对应 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 中的如下代码块 ：</p><p translation-origin=\"off\">Some methods either don't have exact equivalents in <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code>, or they correspond to more than one expression.\nFor example, both renderers have a <code>createElement()</code> method, but they're not equal because a call such as <code>renderer.createElement(parentNode, namespaceAndName)</code> in the <code>Renderer</code> corresponds to the following block of code in <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code>:</p>\n\n<code-example language=\"ts\">\nconst [namespace, name] = splitNamespace(namespaceAndName);\nconst el = renderer.createElement(name, namespace);\nif (parentNode) {\n  renderer.appendChild(parentNode, el);\n}\nreturn el;\n</code-example>\n<p translation-result=\"on\">迁移必须保证函数和变量类型的返回值不变。此原理图会安全地处理大多数情况，它会在用户文件的底部声明一些辅助函数。这些辅助函数封装了你自己的逻辑，把代码中要被替换的内容放到单个函数调用中。这里是 <code>createElement()</code> 迁移工作原理的一个例子：</p><p translation-origin=\"off\">Migration has to guarantee that the return values of functions and types of variables stay the same.\nTo handle the majority of cases safely, the schematic declares helper functions at the bottom of the user's file.\nThese helpers encapsulate your own logic and keep the replacements inside your code down to a single function call.\nHere's an example of how the <code>createElement()</code> migration looks:</p>\n\n<p translation-result=\"on\"><strong>之前：</strong></p><p translation-origin=\"off\"><strong>Before:</strong></p>\n\n<code-example language=\"ts\">\npublic createAndAppendElement() {\n  const el = this.renderer.createElement('span');\n  el.textContent = 'hello world';\n  return el;\n}\n</code-example>\n<p translation-result=\"on\"><strong>之后：</strong></p><p translation-origin=\"off\"><strong>After:</strong></p>\n\n<code-example>\n\npublic createAndAppendElement() {\n  const el = __ngRendererCreateElement(this.renderer, this.element, 'span');\n  el.textContent = 'hello world';\n  return el;\n}\n// Generated code at the bottom of the file\n__ngRendererCreateElement(renderer: any, parentNode: any, nameAndNamespace: any) {\n  const [namespace, name] = __ngRendererSplitNamespace(namespaceAndName);\n  const el = renderer.createElement(name, namespace);\n  if (parentNode) {\n    renderer.appendChild(parentNode, el);\n  }\n  return el;\n}\n__ngRendererSplitNamespace(nameAndNamespace: any) {\n  // returns the split name and namespace\n}\n\n</code-example>\n<p translation-result=\"on\">当实现了这些辅助函数时，此原理图会确保它们在每个文件中都只声明一次，并且它们的名字是唯一的，因此和你的代码中已经存在的函数几乎不可能冲突。该原理图还会把它们的参数类型设为 <code>any</code>， 使其不必插入额外的逻辑就能确保它们的值有正确的类型。</p><p translation-origin=\"off\">When implementing these helper functions, the schematic ensures that they're only declared once per file and that their names are unique enough that there's a small chance of colliding with pre-existing functions in your code. The schematic also keeps their parameter types as <code>any</code> so that it doesn't have to insert extra logic that ensures that their values have the correct type.</p>\n\n<h3 id=\"im-a-library-author-should-i-run-this-migration\" translation-result=\"on\">我是库作者。我应该运行这次迁移吗？<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#im-a-library-author-should-i-run-this-migration\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"im-a-library-author-should-i-run-this-migration\">I’m a library author. Should I run this migration?<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#im-a-library-author-should-i-run-this-migration\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\"><strong>库的作者肯定要做这种迁移来远离 <code>Renderer</code>。否则，这些库将不再适用于用 Angular 9 构建的应用。</strong></p><p translation-origin=\"off\"><strong>Library authors should definitely use this migration to move away from the <code>Renderer</code>. Otherwise, the libraries won't work with applications built with version 9.</strong></p>\n\n<h3 id=\"full-list-of-method-migrations\" translation-result=\"on\">方法迁移的完整列表<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#full-list-of-method-migrations\"><i class=\"material-icons\">link</i></a></h3><h3 translation-origin=\"off\" id=\"full-list-of-method-migrations\">Full list of method migrations<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/migration-renderer#full-list-of-method-migrations\"><i class=\"material-icons\">link</i></a></h3>\n\n<p translation-result=\"on\">下表列出了从 <code>Renderer</code> 到 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 要迁移的所有方法。</p><p translation-origin=\"off\">The following table shows all methods that the migration maps from <code>Renderer</code> to <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code>.</p>\n\n<table>\n<thead>\n<tr>\n<th>Renderer</th>\n<th>Renderer2</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>listen(renderElement, name, callback)</code></td>\n<td><code>listen(renderElement, name, callback)</code></td>\n</tr>\n<tr>\n<td><code>setElementProperty(renderElement, propertyName, propertyValue)</code></td>\n<td><code>setProperty(renderElement, propertyName, propertyValue)</code></td>\n</tr>\n<tr>\n<td><code>setText(renderNode, text)</code></td>\n<td><code>setValue(renderNode, text)</code></td>\n</tr>\n<tr>\n<td><code>listenGlobal(target, name, callback)</code></td>\n<td><code>listen(target, name, callback)</code></td>\n</tr>\n<tr>\n<td><code>selectRootElement(selectorOrNode, debugInfo?)</code></td>\n<td><code>selectRootElement(selectorOrNode)</code></td>\n</tr>\n<tr>\n<td><code>createElement(parentElement, name, debugInfo?)</code></td>\n<td><code>appendChild(parentElement, createElement(name))</code></td>\n</tr>\n<tr>\n<td><code>setElementStyle(el, <a href=\"api/animations/style\" class=\"code-anchor\">style</a>, value?)</code></td>\n<td><code>value == null ? removeStyle(el, <a href=\"api/animations/style\" class=\"code-anchor\">style</a>) : setStyle(el, <a href=\"api/animations/style\" class=\"code-anchor\">style</a>, value)</code></td>\n</tr>\n<tr>\n<td><code>setElementAttribute(el, name, value?)</code></td>\n<td><code>attributeValue == null ? removeAttribute(el, name) : setAttribute(el, name, value)</code></td>\n</tr>\n<tr>\n<td><code>createText(parentElement, value, debugInfo?)</code></td>\n<td><code>appendChild(parentElement, createText(value))</code></td>\n</tr>\n<tr>\n<td><code>createTemplateAnchor(parentElement)</code></td>\n<td><code>appendChild(parentElement, createComment(''))</code></td>\n</tr>\n<tr>\n<td><code>setElementClass(renderElement, className, isAdd)</code></td>\n<td><code>isAdd ? addClass(renderElement, className) : removeClass(renderElement, className)</code></td>\n</tr>\n<tr>\n<td><code>projectNodes(parentElement, nodes)</code></td>\n<td><code>for (let i = 0; i &#x3C; nodes.length; i++) { appendChild(parentElement, nodes[i]); }</code></td>\n</tr>\n<tr>\n<td><code>attachViewAfter(node, viewRootNodes)</code></td>\n<td><code>const parentElement = parentNode(node); const nextSibling = nextSibling(node); for (let i = 0; i &#x3C; viewRootNodes.length; i++) { insertBefore(parentElement, viewRootNodes[i], nextSibling);}</code></td>\n</tr>\n<tr>\n<td><code>detachView(viewRootNodes)</code></td>\n<td><code>for (let i = 0; i &#x3C; viewRootNodes.length; i++) {const node = viewRootNodes[i]; const parentElement = parentNode(node); removeChild(parentElement, node);}</code></td>\n</tr>\n<tr>\n<td><code>destroyView(hostElement, viewAllNodes)</code></td>\n<td><code>for (let i = 0; i &#x3C; viewAllNodes.length; i++) { destroyNode(viewAllNodes[i]); }</code></td>\n</tr>\n<tr>\n<td><code>setBindingDebugInfo()</code></td>\n<td><p translation-result=\"on\">该函数在 <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code> 中无用。</p><p translation-origin=\"off\">This function is a noop in <code><a href=\"api/core/Renderer2\" class=\"code-anchor\">Renderer2</a></code>.</p></td>\n</tr>\n\n<tr>\n<td><code>createViewRoot(hostElement)</code></td>\n<td><p translation-result=\"on\">应该替换成到 <code>hostElement</code> 的引用</p><p translation-origin=\"off\">Should be replaced with a reference to <code>hostElement</code></p></td>\n</tr>\n\n<tr>\n<td><code>invokeElementMethod(renderElement, methodName, args?)</code></td>\n<td><code>(renderElement as any)[methodName].apply(renderElement, args);</code></td>\n</tr>\n<tr>\n<td><code><a href=\"api/animations/animate\" class=\"code-anchor\">animate</a>(element, startingStyles, <a href=\"api/animations/keyframes\" class=\"code-anchor\">keyframes</a>, duration, delay, easing, previousPlayers?)</code></td>\n<td><p translation-result=\"on\">抛出一个错误 (和 <code>Renderer.animate()</code> 一样)</p><p translation-origin=\"off\">Throws an error (same behavior as <code>Renderer.animate()</code>)</p></td>\n</tr>\n\n</tbody>\n</table>\n\n</div>\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/animations/animate\n - api/animations/keyframes\n - api/animations/style\n - api/core/Renderer2\n - guide/migration-renderer#full-list-of-method-migrations\n - guide/migration-renderer#im-a-library-author-should-i-run-this-migration\n - guide/migration-renderer#is-there-action-required-on-my-end\n - guide/migration-renderer#migration-overview\n - guide/migration-renderer#renderer-to-renderer2-migration\n - guide/migration-renderer#what-are-the-__ngrendererx-methods-why-are-they-necessary\n - guide/migration-renderer#why-should-i-migrate-to-renderer2\n - https://github.com/angular/angular-cn/edit/aio/aio/content/guide/migration-renderer.md?message=docs%3A%20请简述你的修改...\n-->"
}